flowchart TD
    create_product[Create Product]
    validate_product_data{Validate Product Data}
    check_duplicate_sku{Check Duplicate SKU}
    persist_product[Persist Product]
    notify_catalog_update([Notify Catalog Update])
    reject_invalid([Reject Invalid])
    reject_duplicate([Reject Duplicate])
    get_product[Get Product]
    lookup_product{Lookup Product}
    check_product_visibility{Check Product Visibility}
    format_product_response([Format Product Response])
    handle_not_found([Handle Not Found])
    update_product[Update Product]
    authorize_update{Authorize Update}
    validate_update_fields{Validate Update Fields}
    apply_update[Apply Update]
    reject_unauthorized([Reject Unauthorized])
    reject_invalid_update([Reject Invalid Update])
    delete_product[Delete Product]
    check_order_references{Check Order References}
    soft_delete_product[Soft Delete Product]
    hard_delete_product[Hard Delete Product]

    create_product --> validate_product_data
    validate_product_data -->|yes| check_duplicate_sku
    validate_product_data -->|no| reject_invalid
    check_duplicate_sku -->|yes| reject_duplicate
    check_duplicate_sku -->|no| persist_product
    persist_product --> notify_catalog_update
    get_product --> lookup_product
    lookup_product -->|yes| check_product_visibility
    lookup_product -->|no| handle_not_found
    check_product_visibility -->|yes| format_product_response
    check_product_visibility -->|no| handle_not_found
    update_product --> authorize_update
    authorize_update -->|yes| validate_update_fields
    authorize_update -->|no| reject_unauthorized
    validate_update_fields -->|yes| apply_update
    validate_update_fields -->|no| reject_invalid_update
    apply_update --> notify_catalog_update
    delete_product --> check_order_references
    check_order_references -->|yes| soft_delete_product
    check_order_references -->|yes| hard_delete_product
    check_order_references -->|no| soft_delete_product
    soft_delete_product --> notify_catalog_update
    hard_delete_product --> notify_catalog_update
